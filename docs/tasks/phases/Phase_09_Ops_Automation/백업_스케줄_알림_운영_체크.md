# Phase 9 — 백업/스케줄/알림 운영 체크

**목적:** 백업·스케줄·알림 실패 시 점검 절차와 복구 방향을 정리한다.  
**관련:** [src/ops/README.md](../../../src/ops/README.md), [09_Ops_Automation_Architecture.md](../../../arch/09_Ops_Automation_Architecture.md)

---

## 1. 백업 실패 시

| 현상 | 확인 | 조치 |
|------|------|------|
| `run_maintenance_automation` 반환 `status == "backup_failed"` | summary 내 `error` 필드 확인 | 디스크 용량, 경로 권한, source_root/backup_root 존재 여부 점검. 백업 성공 전에는 **retention 삭제 없음**(backup-first 보장) |
| `run_maintenance` (coordinator) 의 `backup.success == False` | `MaintenanceReport.backup.error` 확인 | 동일: 용량/권한/경로 점검. cleanup 은 `backup_success=False` 로 호출되므로 삭제 0 |

**원칙:** Backup 실패 시 삭제는 절대 수행하지 않음. 재시도 전에 원인 제거 필요.

---

## 2. 스케줄러 실패/중지 시

| 현상 | 확인 | 조치 |
|------|------|------|
| 특정 대상만 반복 실패 | 로그에서 `Scheduler target <name> failed` 확인 | 해당 대상 콜러블(파이프라인/브로커/대시보드/백업) 원인 조사. `max_consecutive_errors` 초과 시 해당 대상만 스킵(루프는 유지) |
| 루프 중지 필요 | `scheduler.stop()` 호출 또는 `should_stop()` True 반환 | 현재 사이클 완료 후 루프 종료(즉시 중단 아님). 정상 종료 시 로그 `Scheduler loop exited` 확인 |

---

## 3. 알림(Health/Alerts) 실패 시

| 현상 | 확인 | 조치 |
|------|------|------|
| Health 체크 실패 | `HealthMonitor.run_checks()` 결과 중 `ok == False` 항목 확인 | 실패한 항목(google_sheets, repository_health, broker_heartbeat, eteda_loop_latency)별 원인 조사 |
| 치명적 알림 전달 | `LogOnlyAlertChannel` 사용 시 로그 `ALERT CRITICAL` 검색 | 운영자 확인 후 해당 체크 항목 복구. Slack/Telegram 연동 시 동일 프로토콜로 전달 |

---

## 4. 정상 동작 확인

- **백업:** `run_maintenance_automation` 반환 `status == "completed"` 또는 `"nothing_to_do"`. summary 내 `backup`, `deletion` 필드 확인.
- **스케줄러:** 대상 등록 후 `run()` 실행, 로그에 `Scheduler started with N targets` 및 주기적 실행(또는 `should_stop` 전까지) 확인.
- **Health:** `run_checks()` 반환 리스트에서 모든 항목 `ok == True` 및 필요 시 `alert_channel` 미호출 확인.

이 문서는 Phase 9 완료 조건(운영 체크 §2.2) 충족을 위한 운영 체크 목록이다.
