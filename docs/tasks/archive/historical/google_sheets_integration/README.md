# Google Sheets 11-Sheet 연동 태스크

**생성일:** 2026-01-24  
**담당자:** 지정 예정  
**우선순위:** 최우선  
**예상 기간:** 3-4주  

---

## 1. 태스크 개요

QTS 시스템의 핵심 데이터 레이어인 Google Sheets 11개 시트 연동 기능을 구현합니다. 스키마 관리 기반은 완료되었으나, 실제 Google Sheets와의 데이터 연동이 누락된 상태로 이를 해결하여 시스템의 데이터 영속성 기능을 활성화합니다.

## 2. 배경 및 필요성

### 현재 상태
- ✅ 스키마 관리 기반 완료 (`src/runtime/schema/`)
- ✅ 스키마 자동화 테스트 존재
- ❌ Google Sheets 클라이언트 부재
- ❌ 11개 시트 리포지토리 부재
- ❌ 스키마 기반 필드 매핑 미구현

### 문제점
- 모든 거래 기록 및 성과 데이터 저장/조회 불가
- 데이터 레이어 작동 불가 상태
- 시스템의 핵심 데이터 영속성 기능 마비

### 영향
- **치명적**: 프로덕션 운영 불가
- **핵심 갭**: 데이터 기반의 모든 기능 정지

## 3. 목표

### 주요 목표
1. Google Sheets 클라이언트 구현
2. 11개 시트 리포지토리 구현
3. 스키마 기반 필드 매핑 완성
4. 데이터 영속성 기능 활성화

### 성공 기준
- [ ] T_Ledger 시트 연동 완료
- [ ] Position 시트 연동 완료
- [ ] History 시트 연동 완료
- [ ] Strategy_Performance 시트 연동 완료
- [ ] R_Dash 시트 연동 완료
- [ ] 기타 운영 시트 4개 연동 완료
- [ ] 스키마 기반 자동 필드 매핑 동작
- [ ] CRUD 오퍼레이션 정상 동작
- [ ] 에러 핸들링 및 재시도 로직 구현
- [ ] 통합 테스트 통과

## 4. 상세 작업 항목

### 4.1 Google Sheets 클라이언트 구현 (1주)
- [ ] Google Sheets API 클라이언트 클래스 설계
- [ ] 인증 및 권한 관리 구현
- [ ] API 제한 및 캐싱 전략 구현
- [ ] 배치 작업 최적화
- [ ] 에러 핸들링 및 재시도 로직

**파일 위치:** `src/runtime/data/google_sheets_client.py`

### 4.2 시트 리포지토리 구현 (2주)
- [ ] T_Ledger 리포지토리 구현
- [ ] Position 리포지토리 구현  
- [ ] History 리포지토리 구현
- [ ] Strategy_Performance 리포지토리 구현
- [ ] R_Dash 리포지토리 구현
- [ ] 기타 운영 시트 리포지토리 4개 구현
- [ ] 공통 리포지토리 베이스 클래스 설계

**파일 위치:** `src/runtime/data/repositories/`

### 4.3 스키마 기반 필드 매핑 (1주)
- [ ] 스키마-시트 필드 매핑 로직 구현
- [ ] 데이터 타입 변환 처리
- [ ] 필드 유효성 검사
- [ ] 스키마 버전 호환성 처리
- [ ] 자동 필드 감지 및 업데이트

**파일 위치:** `src/runtime/data/mappers/`

### 4.4 통합 및 테스트 (0.5주)
- [ ] 단위 테스트 작성
- [ ] 통합 테스트 작성
- [ ] 성능 테스트
- [ ] 에러 시나리오 테스트
- [ ] 문서화 완료

## 5. 기술 요구사항

### 5.1 필수 기술
- Google Sheets API v4
- Google OAuth 2.0 인증
- Python asyncio (비동기 처리)
- 데이터 캐싱 전략

### 5.2 아키텍처 원칙
- **Contract First**: 스키마 우선 설계
- **Repository Pattern**: 데이터 접근 추상화
- **Error Resilience**: 장애 내성 설계
- **Performance**: API 제한 준수 및 최적화

### 5.3 보안 요구사항
- Google API 인증키 안전한 관리
- 접근 권한 최소화 원칙
- 데이터 암호화 전송
- 감사 로그 기록

## 6. 의존성

### 6.1 선행 조건
- [x] 스키마 관리 시스템 완료
- [x] Google API 인증 설정
- [ ] Google Sheets API 접근 권한 획득

### 6.2 후속 작업
- [ ] Portfolio Engine과 연동
- [ ] Performance Engine과 연동
- [ ] Dashboard 시트 작성기 연동

## 7. 위험 및 완화 방안

### 7.1 기술적 위험
| 위험 | 발생 가능성 | 영향 | 완화 방안 |
|------|-------------|------|-----------|
| Google Sheets API 제한 | 중간 | 높음 | 캐싱 및 배치 작업 구현 |
| 스키마 자동화 복잡성 | 중간 | 중간 | 점진적 구현 및 광범위 테스트 |
| 시트 간 데이터 일관성 | 중간 | 높음 | 검증 레이어 및 트랜잭션 유사 작업 |

### 7.2 운영적 위험
| 위험 | 발생 가능성 | 영향 | 완화 방안 |
|------|-------------|------|-----------|
| API 인증 만료 | 낮음 | 높음 | 자동 토큰 갱신 로직 |
| 네트워크 장애 | 중간 | 중간 | 재시도 로직 및 오프라인 모드 |

## 8. 검토 및 승인

### 8.1 검토 항목
- [ ] 기술 설계 검토 완료
- [ ] 보안 검토 완료
- [ ] 성능 테스트 결과 검토
- [ ] 코드 리뷰 완료

### 8.2 승인 조건
- [ ] 모든 성공 기준 달성
- [ ] 테스트 커버리지 90% 이상
- [ ] 성능 기준 충족
- [ ] 보안 요구사항 충족

## 9. 납품물

### 9.1 코드 납품물
- `src/runtime/data/google_sheets_client.py`
- `src/runtime/data/repositories/` (11개 리포지토리)
- `src/runtime/data/mappers/` (필드 매핑 로직)
- 관련 테스트 코드

### 9.2 문서 납품물
- API 문서
- 아키텍처 설계 문서
- 운영 가이드
- 트러블슈팅 가이드

---

## 10. 연락처

**태스크 관리자:** 지정 예정  
**기술 리뷰어:** 지정 예정  
**보안 리뷰어:** 지정 예정  

**최종 업데이트:** 2026-01-24
