
---

# QTS · Observer Log Specification

## Fixed Log Schema Declaration

---

## 1. 문서 목적

본 문서는 QTS 프로젝트의 **Observer 모듈이 출력하는 로그(JSONL)** 에 대해
**공식 스펙을 고정**하기 위한 기준 문서이다.

이 문서는:

* 실제 실행 코드에서 생성된 로그를 기준으로 작성되었으며
* “이상적인 설계”가 아닌 **현실 로그의 정체성 선언**이다
* 이후 모든 다음 작업의 **상위 근거(anchor)** 로 사용된다

본 문서는 설명 문서가 아니라 **결정 기록 문서**이다.

---

## 2. 적용 범위 (Scope)

본 스펙은 다음 로그에 적용된다.

* Observer 파이프라인을 통해 생성되는 **관측 로그(JSONL)**
* 파일 예시:

  * `observer.jsonl`

다음은 본 스펙의 적용 대상이 아니다.

* 입력 소스 검증용 로그

  * 예: `market_observation.jsonl`
* DB 변환 이후의 가공 로그
* 전략/판단/백테스트 산출물

---

## 3. Observer 로그의 정체성 선언 (핵심)

> **Observer 로그는 판단을 위한 로그가 아니다.**

Observer 로그는:

* 시장에서 발생한 **사실(raw fact)** 을 기록하며
* 수집 단계에서 필요한 **최소한의 맥락(context)** 만을 포함한다

Observer 로그는 다음을 **절대 포함하지 않는다**.

* 매수/매도 판단
* 이벤트 발생 여부
* 전략적 의미
* 수익/손실 관련 정보

---

## 4. 로그 구조 개요

Observer 로그는 JSONL 형식이며,
구조적으로 다음 세 영역으로 구성된다.

```
{
  meta: { ... },
  raw: { ... },
  computed: { ... }
}
```

각 영역의 역할은 명확히 분리된다.

---

## 5. 영역별 스펙 정의

### 5.1 `meta` 영역 (운영 식별자)

**역할**

* 로그의 출처와 시점을 식별
* 운영·재생·추적을 위한 최소 정보 제공

**성격**

* 식별용
* 운영용
* 분석·판단 목적 ❌

**대표 포함 항목 예**

* timestamp / captured_at
* market
* source
* symbol

---

### 5.2 `raw` 영역 (사실 기록)

**역할**

* 시장에서 관측된 **변형되지 않은 사실** 기록
* Observer가 직접 수신한 값

**성격**

* Raw Fact
* 재해석 가능
* 장기 DB 자산화의 원재료

**대표 포함 항목 예**

* price / last_price
* volume / trade_size
* 체결 관련 원본 값

---

### 5.3 `computed` 영역 (경량 파생 정보)

**역할**

* raw 데이터를 기반으로 한 **초단기 맥락 제공**
* 이벤트 기반 수집 밀도 제어를 위한 보조 정보

**성격**

* 경량(light)
* 초단기(short-term)
* 판단 불가 수준

**허용 원칙**

* 매우 짧은 상태(N초 또는 직전 관측)만 사용
* 외부 데이터 참조 ❌
* 장기 누적 ❌
* 전략적 해석 ❌

---

## 6. 고정된 파생 필드 정의 (현재 기준)

### 6.1 `computed.price_delta_short`

**정의**

* 직전 관측 또는 최근 짧은 구간 대비 가격 변화량 또는 변화율

**목적**

* 가격 움직임의 “급함 / 완만함”을
  로그 단위에서 즉시 인지 가능하게 함

**중요 선언**

* 상승/하락 판단 ❌
* 추세 해석 ❌
* 전략 시그널 ❌

---

### 6.2 `computed.volume_delta_short`

**정의**

* 최근 짧은 구간 동안의 거래량 증가량 또는 속도

**목적**

* 거래 집중도 변화에 대한 감각적 인지 제공
* 종목별 절대 거래량 차이를 제거한 비교 기준 확보

**중요 선언**

* 수급 판단 ❌
* 체결 강도 판단 ❌

---

## 7. 명시적 금지 사항 (Red Line)

본 로그 스펙에서 **절대 허용되지 않는 항목**은 다음과 같다.

* 이벤트 발생 여부(Boolean)
* 상승/하락 플래그
* 전략 지표(MA, RSI 등)
* 종목별 기준치 하드코딩
* 장기 상태 누적 값

위 항목이 필요해지는 경우는
**Observer 단계가 아니라 DB/Strategy 단계**이다.

---

## 8. 스켈프 / 스윙 관점 분리 선언

Observer 로그는:

* 스켈프 로그 ❌
* 스윙 로그 ❌

이다.

> **Observer 로그는 공통 원본 로그**이며
> 스켈프/스윙 구분은 **DB 가공 이후 단계**에서만 수행한다.

---

## 9. 변경 원칙 (향후 규칙)

본 로그 스펙은 **기본적으로 고정**된다.

변경이 허용되는 경우는 다음 하나뿐이다.

* 수집 이벤트 트리거 정의 이후
* “정보 부족”이 명확히 입증된 경우

단, 이 경우에도:

* 기존 필드 제거 ❌
* 파생 필드 추가는 **최소 단위**로 제한

---

## 10. 최종 고정 선언

> 본 문서에 정의된 Observer 로그 스펙은
> QTS 프로젝트의 **공식 고정 로그 스펙**으로 채택한다.

> 이후:
>
> * 수집 이벤트 트리거 정의
> * 아카이브 → DB 설계
> * PRD / Architecture 확장

은 모두 **본 스펙을 상위 기준으로 한다.**

---

### 문서 상태

* Status: **Fixed**
* 변경: **차후 별도 세션 합의 시에만 허용**

---
