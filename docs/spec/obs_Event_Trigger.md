# QTS · Event Trigger Specification
## Fixed Criteria Document

---

## 1. 문서 목적

본 문서는 QTS 프로젝트에서 사용되는 **이벤트 트리거(Event Trigger)** 에 대해  
그 **정체성, 적용 범위, 허용 기준**을 정의하는 **공식 스펙 문서**이다.

본 문서는:

- 이벤트 트리거를 **매매 판단이나 전략 요소가 아닌**
  **데이터 수집 해상도 제어 기준**으로 규정하며
- 구현 방식, 운영 단계, 튜닝 절차를 포함하지 않고
- **항상 유지되어야 할 개념적·구조적 기준만을 명시**한다.

본 문서는 아키텍처 문서나 운영 가이드가 아니며,  
**이벤트 트리거의 의미와 역할을 고정하는 기준 문서**이다.

---

## 2. 이벤트 트리거의 정체성 정의 (핵심)

> 이벤트 트리거는  
> **매수·매도 판단을 위한 로직이 아니라,  
> 데이터 수집 해상도를 전환하기 위한 제어 기준**이다.

이벤트 트리거의 목적은 다음으로 한정한다.

- 중요 구간에서의 데이터 손실 방지
- 평시 수집 비용 및 저장 부담 최소화
- 데이터 밀도의 차이를 **의도적으로 생성**

이벤트 트리거는 다음을 **절대 포함하지 않는다**.

- 매수/매도 판단
- 방향성 해석
- 전략적 의미 부여
- 이벤트 발생 여부를 판단 결과(Boolean)로 저장하는 행위

---

## 3. 이벤트 트리거 기준 결정 원칙

이벤트 트리거의 기준은  
**사람이 임의로 수치를 지정하여 결정하지 않는다.**

기준은 다음 원칙에 따라 결정되는 구조를 전제로 한다.

- 이벤트 트리거는  
  **관측 로그의 분포와 패턴을 기반으로 기준이 형성되는 구조**를 따른다.
- 사람(운영자)은:
  - “무엇을 이벤트로 볼 것인가”에 대한 **개념과 범위**를 정의하고
  - “얼마나 희귀해야 하는가”라는 **운영 목표**를 설정한다.
- 구체적인 임계 기준은  
  **누적된 관측 데이터의 분포 분석을 통해 도출**되는 것을 원칙으로 한다.

이 원칙은 이벤트 트리거를  
사전 규칙 기반 판단이 아닌,  
**데이터 기반 기준 형성 구조**로 유지하기 위함이다.

---

## 4. 이벤트 트리거 입력 신호 (고정)

이벤트 트리거는 **Observer 로그의 `computed` 영역**만을 입력으로 사용한다.

허용되는 입력 신호는 다음으로 제한한다.

- `computed.price_delta_short`
- `computed.volume_delta_short`

다음 항목은 명시적으로 사용하지 않는다.

- raw price 단독 기준
- 전략 지표(MA, RSI 등)
- 외부 데이터
- 시간 구간 자체를 이벤트 조건으로 사용하는 방식

---

## 5. 이벤트 트리거 유형 정의

이벤트 트리거는  
**희귀한 상태 변화(state deviation)를 감지하기 위한 기준**으로만 정의한다.

### 5.1 가격 변화 기반 이벤트 (Price-based)

- 관측 기준:  
  가격이 최근 평시 상태 대비 **급격하게 변화**했는가
- 목적:
  - 급격한 가격 이동 구간에서의 데이터 손실 방지
- 포함하지 않는 해석:
  - 상승/하락 방향
  - 추세 판단

---

### 5.2 거래량 변화 기반 이벤트 (Volume-based)

- 관측 기준:  
  거래 활동이 최근 평시 상태 대비 **집중적으로 증가**했는가
- 목적:
  - 체결 집중 구간에서의 데이터 밀도 확보
- 포함하지 않는 해석:
  - 매수/매도 우위
  - 수급 판단

---

### 5.3 변동성 상태 기반 이벤트 (Volatility-derived)

- 관측 기준:  
  짧은 구간에서 가격 변동의 **폭 또는 빈도**가  
  평시 대비 비정상적으로 증가했는가
- 목적:
  - 급변 구간에서의 정보 손실 방지
- 포함하지 않는 해석:
  - 중장기 레짐 판단
  - 추세 전환 해석

---

## 6. 이벤트 발생 시 시스템 행동 기준

이벤트 트리거 조건이 충족될 경우  
시스템은 다음 행동을 수행한다.

1. 데이터 수집 해상도 상향  
   - 분 단위 → 초 단위  
   - 또는 데이터 소스가 허용하는 경우 틱 단위
2. 고해상도 유지 조건 감시
3. 해상도 복귀 조건 감시

데이터 수집 해상도 상향은  
**시스템 및 데이터 소스가 허용하는 범위 내에서  
가능한 가장 높은 해상도까지 상향하는 것을 원칙**으로 한다.

이벤트 발생 사실 자체는  
**판단 결과나 전략 정보로 저장하지 않는다**.

---

## 7. 폭주 방지 및 안정성 기준 (필수)

이벤트 트리거 적용 시  
다음 기준은 항상 함께 적용되어야 한다.

- 이벤트 재진입 쿨다운
- 동시 이벤트 수 제한
- 일정 기간 내 고해상도 유지 시간 상한
- 장애 또는 이상 상황 발생 시 저해상도 강제 전환(폴백)

이 기준의 목적은 다음과 같다.

- 비용 폭증 방지
- 데이터 파이프라인 안정성 확보
- 운영자가 예측 가능한 시스템 동작 보장

구체적인 수치, 정책, 튜닝 방식은  
본 문서의 범위에 포함하지 않는다.

---

## 8. 시간 구간 특성에 대한 명시적 제외 규칙

다음 시간 구간에서는  
**이벤트 트리거를 발동하지 않는다.**

- 장 시작 이후 일정 시간 구간
- 장 마감 이전 일정 시간 구간

이 규칙은 **절대 시간값에 의존하지 않으며**,  
각 시장의 거래 시간 정의를 기준으로 적용한다.

예시:

- 장 시작 후 30분
- 장 마감 전 30분

이 시간 구간은:

- 구조적으로 변동성과 거래량이 왜곡되기 쉬운 구간이며
- “희귀한 상태 변화”가 아니라  
  **시장 구조상 반복적으로 발생하는 특성 구간**으로 간주한다.

해당 구간의 데이터는:

- DB 정제 단계에서 태깅
- 분석 단계에서 분리 또는 보정

하는 것을 원칙으로 하며,  
**이벤트 트리거 단계에서는 시간 자체를 기준으로 판단하지 않는다.**

---

## 9. 변경 및 확장 원칙

본 스펙 문서에 정의된 기준은  
**이벤트 트리거의 기본 의미와 역할을 고정**한다.

- 수치 조정, 운영 주기, 튜닝 절차는 본 문서의 범위가 아니다.
- 본 문서의 변경은  
  이벤트 트리거의 **정체성 또는 입력 신호 체계가 변경되는 경우**에만 허용된다.

---

## 10. 문서 상태 선언

본 문서는 **Fixed** 상태이다.

본 문서에 정의된 이벤트 트리거 기준은  
QTS 프로젝트 전반에서 **공식 기준 문서**로 사용된다.

---
