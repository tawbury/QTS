# Plan: 피드백-루프 (Feedback Loop)

## Feature Overview
- **Feature Name**: 피드백-루프
- **Phase**: 6/6 (Architecture Sub-document Pipeline)
- **Source**: `docs/arch/sub/20_Feedback_Loop_Architecture.md`
- **Priority**: High (Continuous Improvement Loop)

## Background
ETEDA 실행 데이터를 Evaluate 엔진 학습에 활용하여 실행 품질 개선,
슬리피지 예측, 시장 충격 최소화를 달성하는 Continuous Improvement Loop.
실행 → 분석 → 학습 → 개선 사이클을 통해 전략 파라미터를 동적 조정한다.

## Scope

### In Scope
1. FeedbackData 계약 (TickRecord, FeedbackSummary, configs)
2. Slippage 계산 (basis points)
3. Execution Quality Score (가중 평균: slippage 50%, fill 30%, latency 20%)
4. Market Impact Estimation (Kyle's Lambda 단순화)
5. FeedbackAggregator (ExecutionResult → FeedbackData 변환)
6. Strategy Enhancement (슬리피지 보정 진입가, 수량 조정)
7. FeedbackSummary with fallback defaults
8. KPI 기준값 (slippage < 10bps, quality > 0.85 등)

### Out of Scope
- ML 모델 학습 알고리즘 (SlippagePredictionModel은 stub만)
- 실제 DB 연동 (TimescaleDB, Protocol로 추상화)
- 브로커별 실행 차이 분석
- UI 대시보드

## Technical Approach
- Phase 4 (스캘프-실행) ExecutionResult를 입력으로 사용
- Protocol 기반 외부 의존성 주입 (DBAdapter)
- Decimal 기반 금융 계산
- 동기식 테스트 가능 설계 (async는 Protocol 뒤로)
- Fail-Safe: 피드백 실패가 매매를 중단시키지 않음

## Implementation Order
1. contracts.py — 데이터 계약 (TickRecord, FeedbackData, FeedbackSummary, configs)
2. slippage.py — 슬리피지 계산 (bps)
3. quality.py — Execution Quality Score
4. impact.py — Market Impact Estimation
5. aggregator.py — FeedbackAggregator
6. strategy_enhancer.py — 슬리피지 보정, 수량 조정
7. kpi.py — KPI 기준값 및 평가

## Dependencies
- `src/execution/contracts.py` — ExecutionResult, FillEvent, OrderDecision
- `src/provider/models/order_request.py` — OrderSide, OrderType

## Success Criteria
- 단위 테스트: 모듈별 10+ 케이스
- 통합 테스트: 전체 피드백 루프 사이클
- Gap Analysis >= 90%
- 기존 테스트 회귀 없음
